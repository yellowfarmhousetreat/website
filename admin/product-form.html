<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Product Manager - Yellow Farmhouse Treats</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif; background: #f5f5f5; padding: 20px; }
    .container { max-width: 800px; margin: 0 auto; background: white; padding: 40px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
    h1 { color: #333; margin-bottom: 10px; }
    .subtitle { color: #666; margin-bottom: 30px; font-size: 14px; }
    .form-section { margin-bottom: 30px; padding-bottom: 30px; border-bottom: 1px solid #eee; }
    .form-section h3 { color: #555; font-size: 16px; margin-bottom: 20px; }
    .form-group { margin-bottom: 20px; }
    label { display: block; margin-bottom: 8px; color: #333; font-weight: 500; font-size: 14px; }
    .required::after { content: " *"; color: #d32f2f; }
    input, select, textarea { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; font-family: inherit; }
    textarea { resize: vertical; min-height: 80px; }
    input:focus, select:focus, textarea:focus { outline: none; border-color: #1976d2; box-shadow: 0 0 0 3px rgba(25, 118, 210, 0.1); }
    .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
    .checkbox-group { display: flex; gap: 20px; }
    .checkbox-group label { display: flex; align-items: center; gap: 8px; margin: 0; }
    input[type="checkbox"] { width: auto; }
    button { padding: 12px 24px; background: #1976d2; color: white; border: none; border-radius: 4px; font-size: 14px; font-weight: 600; cursor: pointer; transition: background 0.2s; }
    button:hover { background: #1565c0; }
    .output { background: #f5f5f5; padding: 20px; border-radius: 4px; margin-top: 30px; }
    .output h3 { margin-bottom: 15px; color: #333; }
    pre { background: white; padding: 15px; border-radius: 4px; overflow-x: auto; font-size: 12px; }
    .success { color: #388e3c; background: #f1f8e9; padding: 12px 16px; border-radius: 4px; margin-top: 15px; display: none; }
    .error { color: #d32f2f; background: #ffebee; padding: 12px 16px; border-radius: 4px; margin-top: 15px; display: none; }
    .instructions { background: #e3f2fd; padding: 15px; border-radius: 4px; margin-bottom: 30px; color: #1565c0; font-size: 13px; line-height: 1.6; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Add New Product</h1>
    <p class="subtitle">All required fields must be completed. Optional fields will be auto-filled with defaults.</p>
    
    <div class="instructions">
      <strong>Instructions:</strong> Fill out the form and submit to generate JSON. Copy the output and add it to products-data.json in the products array.
    </div>

    <form id="productForm">
      <!-- REQUIRED FIELDS -->
      <div class="form-section">
        <h3>Required Fields</h3>
        
        <div class="form-group">
          <label for="id" class="required">Product ID</label>
          <input type="text" id="id" name="id" placeholder="e.g., chocolate-chip-cookies" required>
          <small style="color: #999; display: block; margin-top: 4px;">URL-safe identifier (lowercase, hyphens)</small>
        </div>

        <div class="form-group">
          <label for="name" class="required">Product Name</label>
          <input type="text" id="name" name="name" placeholder="e.g., Chocolate Chip Cookies" required>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="category" class="required">Category</label>
            <select id="category" name="category" required>
              <option value="">Select...</option>
              <option value="cookies">Cookies</option>
              <option value="cakes">Cakes</option>
              <option value="pies">Pies</option>
              <option value="breads">Breads</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="tier">Tier</label>
            <select id="tier" name="tier">
              <option value="Regular" selected>Regular</option>
              <option value="Fancy">Fancy</option>
              <option value="Complex">Complex</option>
            </select>
          </div>
        </div>

        <div class="form-group">
          <label for="description" class="required">Description</label>
          <textarea id="description" name="description" placeholder="Short product description" required></textarea>
        </div>

        <div class="form-group">
          <label for="image" class="required">Image Path</label>
          <input type="text" id="image" name="image" placeholder="e.g., images/cookies-chocolate-chip.jpg" required>
        </div>

        <div class="form-group">
          <label for="sizes" class="required">Sizes (JSON)</label>
          <textarea id="sizes" name="sizes" placeholder='[{"name": "1/2 dozen", "price": 12}, {"name": "dozen", "price": 20}]' required></textarea>
        </div>

        <div class="form-group">
          <label for="dietary" class="required">Dietary (JSON)</label>
          <textarea id="dietary" name="dietary" placeholder='{"glutenFree": true, "sugarFree": false, "vegan": false}' required></textarea>
        </div>
      </div>

      <!-- OPTIONAL FIELDS -->
      <div class="form-section">
        <h3>Optional Fields (auto-filled if blank)</h3>
        
        <div class="form-group">
          <label for="ingredients">Ingredients</label>
          <textarea id="ingredients" name="ingredients" placeholder="Leave blank for default"></textarea>
        </div>

        <div class="form-group">
          <label for="allergens">Allergens</label>
          <textarea id="allergens" name="allergens" placeholder="Leave blank for default"></textarea>
        </div>

        <div class="checkbox-group">
          <label>
            <input type="checkbox" name="shippable">
            Shippable
          </label>
          <label>
            <input type="checkbox" name="soldOut">
            Sold Out
          </label>
        </div>
      </div>

      <button type="submit">Generate JSON</button>
      <div class="success" id="success">âœ“ Product validated successfully!</div>
      <div class="error" id="error"></div>
    </form>

    <div class="output" id="outputSection" style="display: none;">
      <h3>Generated JSON (Copy and paste into products-data.json):</h3>
      <pre id="output"></pre>
    </div>
  </div>

  <script src="../assets/js/product-manager.js"></script>
  <script>
    document.getElementById('productForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      // Clear previous messages
      document.getElementById('success').style.display = 'none';
      document.getElementById('error').style.display = 'none';
      document.getElementById('outputSection').style.display = 'none';

      try {
        await ProductManager.loadSchema();
        
        const formData = new FormData(e.target);
        const product = Object.fromEntries(formData);

        // Parse JSON fields
        try {
          product.sizes = JSON.parse(product.sizes);
          product.dietary = JSON.parse(product.dietary);
        } catch (err) {
          throw new Error('Invalid JSON in sizes or dietary fields: ' + err.message);
        }

        // Convert checkboxes
        product.shippable = formData.has('shippable');
        product.soldOut = formData.has('soldOut');

        // Validate
        const { valid, errors } = ProductManager.validateProduct(product);
        if (!valid) {
          document.getElementById('error').textContent = 'Errors: ' + errors.join(', ');
          document.getElementById('error').style.display = 'block';
          return;
        }

        // Fill defaults
        ProductManager.fillDefaults(product);

        // Display result
        document.getElementById('output').textContent = JSON.stringify(product, null, 2) + ',';
        document.getElementById('outputSection').style.display = 'block';
        document.getElementById('success').style.display = 'block';
      } catch (err) {
        document.getElementById('error').textContent = 'Error: ' + err.message;
        document.getElementById('error').style.display = 'block';
      }
    });
  </script>
</body>
</html>
