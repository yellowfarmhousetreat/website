<!DOCTYPE HTML>
            // Render Products
            renderProducts() {
                const container = document.getElementById('product-list');
                
                if (this.products.length === 0) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 2rem; opacity: 0.7;">
                            <h3>No Products Found</h3>
                            <p>Click "Add Product" to create your first product.</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = `
                    <div class="products-grid">
                        ${this.products.map((product, index) => this.renderProductCard(product, index)).join('')}
                    </div>
                `;
            }

            // Render Individual Product Card
            renderProductCard(product, index) {
                return `
                    <div class="product-card" data-product-index="${index}">
                        <div class="product-header">
                            <div class="product-title-section">
                                <h3>${this.escapeHtml(product.name)}</h3>
                                <div class="sold-out-badge" style="display: ${product.soldOut ? 'block' : 'none'};">
                                    SOLD OUT
                                </div>
                            </div>
                            <div class="product-controls">
                                <label class="sold-out-toggle">
                                    <input type="checkbox" ${product.soldOut ? 'checked' : ''} 
                                           onchange="adminInterface.toggleProductSoldOut(${index})">
                                    <span class="sold-out-label">Sold Out</span>
                                </label>
                                    <div style="display: flex; gap: 0.5rem;">
                                        <button onclick="adminInterface.saveProduct(${index})" class="btn btn-success btn-small">
                                            Save
                                        </button>
                                        <button onclick="adminInterface.deleteProduct(${index})" class="btn btn-danger btn-small">
                                            Delete
                                        </button>
                                        <button type="button" class="btn btn-danger btn-small" 
                                                onclick="adminInterface.removeSize(${productIndex}, ${sizeIndex})"
                                                ${sizes.length <= 1 ? 'disabled' : ''}>Ã—</button>
                                    </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Product Name:</label>
                            <input type="text" value="${this.escapeHtml(product.name)}" 
                                   onchange="adminInterface.updateProduct(${index}, 'name', this.value)">
                        </div>
                        
                        <div class="form-group">
                            <label>Category:</label>
                            <select onchange="adminInterface.updateProduct(${index}, 'category', this.value)">
                                <option value="cookies" ${product.category === 'cookies' ? 'selected' : ''}>Cookies</option>
                                <option value="cakes" ${product.category === 'cakes' ? 'selected' : ''}>Cakes</option>
                                <option value="pies" ${product.category === 'pies' ? 'selected' : ''}>Pies</option>
                                <option value="breads" ${product.category === 'breads' ? 'selected' : ''}>Breads</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>Description:</label>
                            <textarea onchange="adminInterface.updateProduct(${index}, 'description', this.value)">${this.escapeHtml(product.description)}</textarea>
                        </div>
                        
                        <div class="form-group">
                            <label>Ingredients (in order of quantity):</label>
                            <textarea placeholder="e.g., Flour, Sugar, Butter, Eggs, Vanilla Extract, Salt, Baking Soda" 
                                      onchange="adminInterface.updateProduct(${index}, 'ingredients', this.value)">${this.escapeHtml(product.ingredients)}</textarea>
                        </div>
                        
                        <div class="form-group">
                            <label>Sizes & Pricing:</label>
                            <div id="sizes-${index}">
                                ${this.renderSizes(product.sizes, index)}
                            </div>
                            <button type="button" class="btn btn-secondary btn-small" 
                                    onclick="adminInterface.addSize(${index})">+ Add Size</button>
                        </div>
                        
                        <div class="form-group">
                            <label>Allergen Information:</label>
                            <div class="checkbox-group">
                                ${this.renderAllergens(product.allergens, index)}
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Dietary Options:</label>
                            <div class="checkbox-group">
                                <div class="checkbox-item">
                                    <input type="checkbox" id="gf-${index}" ${product.dietary.glutenFree ? 'checked' : ''} 
                                           onchange="adminInterface.updateDietary(${index}, 'glutenFree', this.checked)">
                                    <label for="gf-${index}">Gluten Free Available</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="sf-${index}" ${product.dietary.sugarFree ? 'checked' : ''} 
                                           onchange="adminInterface.updateDietary(${index}, 'sugarFree', this.checked)">
                                    <label for="sf-${index}">Sugar Free Available</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="vegan-${index}" ${product.dietary.vegan ? 'checked' : ''} 
                                           onchange="adminInterface.updateDietary(${index}, 'vegan', this.checked)">
                                    <label for="vegan-${index}">Vegan Available</label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Product Photo:</label>
                            <div class="photo-upload">
                                <div class="photo-buttons">
                                        <button type="button" class="btn btn-secondary btn-small" 
                                            onclick="adminInterface.triggerPhoto(${index}, 'library')">Photos</button>
                                        <button type="button" class="btn btn-secondary btn-small" 
                                            onclick="adminInterface.triggerPhoto(${index}, 'camera')">Camera</button>
                                        <button type="button" class="btn btn-secondary btn-small" 
                                            onclick="adminInterface.triggerPhoto(${index}, 'files')">Files</button>
                                </div>
                                <input type="file" id="photo-library-${index}" class="file-input" 
                                       accept="image/*" 
                                       onchange="adminInterface.handlePhoto(event, ${index})">
                                <input type="file" id="photo-camera-${index}" class="file-input" 
                                       accept="image/*" capture="environment"
                                       onchange="adminInterface.handlePhoto(event, ${index})">
                                <input type="file" id="photo-files-${index}" class="file-input" 
                                       accept="image/*,image/heic,image/jpeg,image/png,image/gif,image/webp" 
                                       onchange="adminInterface.handlePhoto(event, ${index})">
                            </div>
                            <input type="text" value="${this.escapeHtml(product.image)}" 
                                   placeholder="Or enter filename manually"
                                   onchange="adminInterface.updateProduct(${index}, 'image', this.value)">
                        </div>
                        
                        <div class="form-group">
                            <div class="checkbox-group">
                                <div class="checkbox-item">
                                    <input type="checkbox" id="ship-${index}" ${product.shippable ? 'checked' : ''} 
                                           onchange="adminInterface.updateProduct(${index}, 'shippable', this.checked)">
                                    <label for="ship-${index}">Shipping Available</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="feat-${index}" ${product.featured ? 'checked' : ''} 
                                           onchange="adminInterface.updateProduct(${index}, 'featured', this.checked)">
                                    <label for="feat-${index}">Featured Product</label>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            // Render Sizes
            renderSizes(sizes, productIndex) {
                return sizes.map((size, sizeIndex) => `
                    <div class="size-row">
                        <input type="text" value="${this.escapeHtml(size.name)}" 
                               placeholder="Size name" 
                               onchange="adminInterface.updateSize(${productIndex}, ${sizeIndex}, 'name', this.value)">
                        <input type="number" step="0.01" value="${size.price}" 
                               placeholder="Price" 
                               onchange="adminInterface.updateSize(${productIndex}, ${sizeIndex}, 'price', parseFloat(this.value))">
                        <button type="button" class="btn btn-danger btn-small" 
                                onclick="adminInterface.removeSize(${productIndex}, ${sizeIndex})"
                                ${sizes.length <= 1 ? 'disabled' : ''}>Ã—</button>
                    </div>
                `).join('');
            }

            // Render Allergens
            renderAllergens(allergens, productIndex) {
                const commonAllergens = ['wheat', 'eggs', 'milk', 'nuts', 'peanuts', 'soy'];
                
                return commonAllergens.map(allergen => `
                    <div class="checkbox-item">
                        <input type="checkbox" id="allergen-${allergen}-${productIndex}" 
                               ${allergens.includes(allergen) ? 'checked' : ''} 
                               onchange="adminInterface.updateAllergen(${productIndex}, '${allergen}', this.checked)">
                        <label for="allergen-${allergen}-${productIndex}">Contains ${allergen.charAt(0).toUpperCase() + allergen.slice(1)}</label>
                    </div>
                `).join('');
            }

            // Update Functions
            updateProduct(index, field, value) {
                if (this.products[index]) {
                    this.products[index][field] = value;
                    this.showMessage(`Updated ${field}`, 'info');
                }
            }

            updateDietary(index, field, value) {
                if (this.products[index]) {
                    this.products[index].dietary[field] = value;
                    this.showMessage(`Updated dietary option`, 'info');
                }
            }

            updateAllergen(index, allergen, isChecked) {
                if (this.products[index]) {
                    if (isChecked) {
                        if (!this.products[index].allergens.includes(allergen)) {
                            this.products[index].allergens.push(allergen);
                        }
                    } else {
                        this.products[index].allergens = this.products[index].allergens.filter(a => a !== allergen);
                    }
                    this.showMessage(`Updated allergen info`, 'info');
                }
            }

            updateSize(productIndex, sizeIndex, field, value) {
                if (this.products[productIndex] && this.products[productIndex].sizes[sizeIndex]) {
                    this.products[productIndex].sizes[sizeIndex][field] = value;
                    this.showMessage(`Updated size ${field}`, 'info');
                }
            }

            // Size Management
            addSize(productIndex) {
                if (this.products[productIndex]) {
                    this.products[productIndex].sizes.push({ name: 'new size', price: 20 });
                    document.getElementById(`sizes-${productIndex}`).innerHTML = 
                        this.renderSizes(this.products[productIndex].sizes, productIndex);
                    this.showMessage('Added new size', 'success');
                }
            }

            removeSize(productIndex, sizeIndex) {
                if (this.products[productIndex] && this.products[productIndex].sizes.length > 1) {
                    this.products[productIndex].sizes.splice(sizeIndex, 1);
                    document.getElementById(`sizes-${productIndex}`).innerHTML = 
                        this.renderSizes(this.products[productIndex].sizes, productIndex);
                    this.showMessage('Removed size', 'info');
                }
            }

            // Photo Management
            triggerPhoto(index, type) {
                document.getElementById(`photo-${type}-${index}`).click();
            }

            handlePhoto(event, index) {
                const file = event.target.files[0];
                if (file) {
                    const filename = `${this.products[index].name.toLowerCase().replace(/[^a-z0-9]/g, '-')}.${file.name.split('.').pop()}`;
                    this.products[index].image = filename;
                    
                    // Update the manual filename input
                    const manualInput = event.target.closest('.form-group').querySelector('input[type="text"]');
                    if (manualInput) {
                        manualInput.value = filename;
                    }
                    
                    this.showMessage(`Photo selected: ${filename}`, 'success');
                    
                    // TODO: In a real app, upload the file here
                }
            }

            // Product Management
            addNewProduct() {
                const newProduct = {
                    id: `product-${Date.now()}`,
                    name: 'New Product',
                    category: 'cookies',
                    description: 'Enter product description',
                    ingredients: 'List ingredients here',
                    allergens: [],
                    image: 'product-image.jpg',
                    sizes: [{ name: 'dozen', price: 20 }],
                    dietary: { glutenFree: false, sugarFree: false, vegan: false },
                    shippable: false,
                    featured: false
                };
                
                this.products.push(newProduct);
                this.renderProducts();
                this.showMessage('New product added', 'success');
            }

            deleteProduct(index) {
                if (confirm('Are you sure you want to delete this product?')) {
                    const productName = this.products[index].name;
                    this.products.splice(index, 1);
                    this.renderProducts();
                    this.showMessage(`Deleted ${productName}`, 'info');
                }
            }

            // Save Individual Product
            saveProduct(index) {
                const product = this.products[index];
                const exportProduct = this.convertToExportFormat(product);
                const jsContent = this.generateIndividualJS(exportProduct, index);
                
                this.downloadFile(jsContent, `${product.name.toLowerCase().replace(/[^a-z0-9]/g, '-')}.js`);
                this.showMessage(`Saved ${product.name}`, 'success');
            }

            // Export All Products
            exportAll() {
                const exportProducts = this.products.map(p => this.convertToExportFormat(p));
                const jsContent = this.generateFullJS(exportProducts);
                
                this.downloadFile(jsContent, 'products-data.json');
                this.showMessage('Exported all products', 'success');
            }

            // Convert to Export Format
            convertToExportFormat(product) {
                return {
                    id: product.id,
                    name: product.name,
                    category: product.category,
                    description: product.description,
                    ingredients: product.ingredients,
                    allergens: product.allergens,
                    image: product.image,
                    sizes: product.sizes,
                    dietary: product.dietary,
                    shippable: product.shippable,
                    featured: product.featured,
                    idahoDisclaimer: "This product was produced in a home kitchen that is not subject to public health inspection that may also process common food allergens. If you have safety concerns, contact your local health department."
                };
            }

            // Generate JS Files
            generateIndividualJS(product, index) {
                return `/**
 * INDIVIDUAL PRODUCT UPDATE
 * Product: ${product.name}
 * Generated: ${new Date().toLocaleString()}
 */

const UPDATED_PRODUCT = ${JSON.stringify(product, null, 4)};

// Original array index: ${index}
// Product ID: ${product.id}

/* 
TO UPDATE YOUR MAIN FILE:
1. Open data/products-data.json
2. Find the product with id: '${product.id}'
3. Replace it with the UPDATED_PRODUCT object above
4. Save the file
*/`;
            }

            generateFullJS(products) {
                return `${JSON.stringify({
                    schemaVersion: 'yellowfarmhouse.products.v1',
                    version: new Date().toISOString(),
                    products: products,
                    dietaryPricing: { glutenFree: 3, sugarFree: 3, vegan: 2 },
                    paymentMethods: {
                        cash: { name: 'Cash', instructions: 'Payment due at pickup' },
                        cashapp: { name: 'Cash App', instructions: 'Send payment to $YellowFarmhouse' },
                        venmo: { name: 'Venmo', instructions: 'Send payment to @YellowFarmhouse' },
                        paypal: { name: 'PayPal', instructions: 'Send payment to yellowfarmhouse@email.com' },
                        zelle: { name: 'Zelle', instructions: 'Send payment to (555) 123-4567' }
                    },
                    shippingZones: {
                        '12345': 5.00,
                        '12346': 5.00,
                        '12347': 7.50,
                        '12348': 7.50,
                        '12349': 10.00
                    },
                    metadata: {
                        generatedBy: 'cookiewagon-admin',
                        updatedAt: new Date().toISOString()
                    }
                }, null, 2)}`;
            }

            // Utility Functions
            downloadFile(content, filename) {
                const blob = new Blob([content], { type: 'text/javascript' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }

            // Site Config Persistence Methods
            saveAdminState() {
                try {
                    // Use siteConfig system for site-wide persistence
                    if (window.siteConfig) {
                        // Save orders paused state
                        window.siteConfig.pauseOrders(this.pauseOrders);
                        
                        // Save sold out products by ID
                        this.products.forEach(product => {
                            window.siteConfig.setSoldOut(product.id, product.soldOut || false);
                        });
                        
                        this.showMessage('âœ… Admin state saved site-wide', 'success');
                        console.log('Admin state saved via siteConfig system');
                    } else {
                        throw new Error('siteConfig system not available');
                    }
                } catch (error) {
                    this.showMessage('âŒ Failed to save admin state', 'error');
                    console.error('Site config save error:', error);
                }
            }
            
            loadAdminState() {
                try {
                    // Use siteConfig system for site-wide persistence
                    if (window.siteConfig) {
                        const config = window.siteConfig.get();
                        
                        // Load orders paused state
                        this.pauseOrders = config.ordersPaused;
                        
                        // Apply sold out states to loaded products
                        this.products.forEach(product => {
                            if (config.soldOutProducts && config.soldOutProducts.includes(product.id)) {
                                product.soldOut = true;
                            }
                        });
                        
                        if (config.lastUpdated) {
                            const savedDate = new Date(config.lastUpdated).toLocaleString();
                            this.showMessage(`ðŸ“‹ Admin state loaded (last updated: ${savedDate})`, 'info');
                        }
                        
                        console.log('Admin state loaded via siteConfig system', config);
                    } else {
                        console.warn('siteConfig system not available - using defaults');
                    }
                } catch (error) {
                    this.showMessage('âš ï¸ Failed to load saved admin state', 'warning');
                    console.error('Site config load error:', error);
                }
            }
            
            resetAdminState() {
                if (confirm('Reset all admin customizations?\n\nThis will clear:\nâ€¢ All "Sold Out" flags\nâ€¢ Orders paused status\nâ€¢ Return to original products-data.json state\n\nContinue?')) {
                    try {
                        // Use siteConfig system to reset site-wide state
                        if (window.siteConfig) {
                            // Reset orders paused
                            window.siteConfig.pauseOrders(false);
                            
                            // Reset all sold out flags
                            this.products.forEach(product => {
                                window.siteConfig.setSoldOut(product.id, false);
                            });
                        }
                        
                        // Reset in-memory state
                        this.pauseOrders = false;
                        this.products.forEach(product => {
                            product.soldOut = false;
                        });
                        
                        // Refresh UI
                        this.updateOrderStatusUI();
                        this.renderProducts();
                        
                        this.showMessage('ðŸ”„ Admin state reset to defaults site-wide', 'success');
                        console.log('Admin state reset via siteConfig system');
                    } catch (error) {
                        this.showMessage('âŒ Failed to reset admin state', 'error');
                        console.error('Site config reset error:', error);
                    }
                }
            }

            // UX Enhancement Functions
            toggleOrderPause() {
                this.pauseOrders = !this.pauseOrders;
                this.updateOrderStatusUI();
                this.saveAdminState(); // Auto-save on change
                this.showMessage(`Orders ${this.pauseOrders ? 'paused' : 'resumed'}`, this.pauseOrders ? 'warning' : 'success');
            }

            updateOrderStatusUI() {
                const statusEl = document.getElementById('pause-status');
                const statusText = statusEl.querySelector('.status-text');
                
                if (this.pauseOrders) {
                    statusEl.className = 'status-indicator paused';
                    statusText.textContent = 'Paused';
                } else {
                    statusEl.className = 'status-indicator active';
                    statusText.textContent = 'Active';
                }
            }

            toggleProductSoldOut(productIndex) {
                if (this.products[productIndex]) {
                    this.products[productIndex].soldOut = !this.products[productIndex].soldOut;
                    const product = this.products[productIndex];
                    this.saveAdminState(); // Auto-save on change
                    this.showMessage(`${product.name} marked as ${product.soldOut ? 'SOLD OUT' : 'available'}`, 
                                     product.soldOut ? 'warning' : 'success');
                    
                    // Update the UI for this product
                    this.updateProductSoldOutUI(productIndex);
                }
            }

            updateProductSoldOutUI(productIndex) {
                const productCard = document.querySelector(`[data-product-index="${productIndex}"]`);
                if (productCard) {
                    const soldOutToggle = productCard.querySelector('.sold-out-toggle input');
                    const soldOutBadge = productCard.querySelector('.sold-out-badge');
                    
                    if (soldOutToggle) {
                        soldOutToggle.checked = this.products[productIndex].soldOut;
                    }
                    
                    if (soldOutBadge) {
                        soldOutBadge.style.display = this.products[productIndex].soldOut ? 'block' : 'none';
                    }
                }
            }

            showMessage(message, type = 'info') {
                const messagesContainer = document.getElementById('messages');
                const messageEl = document.createElement('div');
                messageEl.className = `message message-${type}`;
                messageEl.textContent = message;
                
                messagesContainer.appendChild(messageEl);
                
                setTimeout(() => {
                    if (messageEl.parentNode) {
                        messageEl.parentNode.removeChild(messageEl);
                    }
                }, 3000);
            }

            escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }
        }

        // Global Functions
        let adminInterface;

        document.addEventListener('DOMContentLoaded', function() {
            adminInterface = new SimpleAdminInterface();
            window.adminInterface = adminInterface;
            console.log('[Admin] adminInterface initialized:', !!adminInterface);
        });

        function handleLogin() {
            if (!adminInterface) {
                // Show visible error message in the login form
                var loginForm = document.querySelector('.login-form');
                <!-- Login Form Container -->
                <div id="login-form" class="login-container"></div>

                <!-- Admin Panel Container -->
                <div id="admin-panel" class="hidden">
                    <div id="admin-header"></div>
                    <div id="product-list"></div>
                </div>

                <!-- Messages Area -->
                <div id="messages" class="messages"></div>